<link href="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.css" rel="stylesheet">

<script src="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.js"></script>

<!-- bread-crumb start here -->
<div class="bread-crumb">
	<img src="/main_theme/images/banner-top.jpg" class="img-responsive" alt="banner-top" title="banner-top">
	<div class="container">
		<div class="matter">Compare</div>
	</div>
</div>
<!-- bread-crumb end here -->

<!-- coures start here -->
<div class="coures">
	<div class="container">
		<div class="row">
			<div class="col-sm-3 col-xs-12 hidden-xs">
				<div class="left">
					<h4>POPULAR COURSES</h4>
					<div class="popular">
						{{#each data}}
						<a href="/detail/{{this.Institution.name}}/{{this.name}}/{{this.id}}">
							<div class="box">
								<img src="/main_theme/images/p1.jpg" class="img-responsive" alt="img" title="img" />
								<p>{{this.name}}</p>
								<span>Â£{{this.fee}}</span>
							</div>
						</a>
						{{/each}}
					</div>
				</div>
			</div>
			<div class="col-sm-9 col-xs-12">

				<div class="col-sm-12 sort">
					<h3 style="text-align:center">Compare</h3>
				</div>
				<div ng-controller="school" class="col-sm-12 sort">
					<div class="row">

						<div class="col-lg-2"></div>
						<div class="col-lg-8">
							<select id="cboSearchType" class="form-control">
								<option value="0">Compare Fees</option>
								<option value="1">Compare Courses</option>
								<option value="2">Seek Professional Advice</option>
							</select>
						</div>
						<div class="col-lg-2"></div>
					</div>
					<hr>
					<div class="row feeCompareContainer">
						<div class="col-lg-3">
							<select id="uni1" class="form-control">
								<option value="0">--Institution 1--</option>

								<option value="{[{u.uni.id}]}" ng-repeat="u in menu">{[{u.uni.name}]}</option>

							</select>
						</div>
						<div class="col-lg-4">
							<select id="uni2" class="form-control">
								<option value="0">--Institution 2--</option>
								<option value="{[{u.uni.id}]}" ng-repeat="u in menu">{[{u.uni.name}]}</option>
							</select>
						</div>
						<div class="col-lg-4">
							<select id="faculty" class="form-control">
								<option value="0">--Select Faculty--</option>
								<option value="0">All</option>
								<option value="{[{u.id}]}" ng-repeat="u in drop.faculty">{[{u.name}]}</option>
							</select>
						</div>
						<div class="col-lg-1">
							<button id="btnSearch" class="btn btn-primary"> <i class="fa fa-search"></i></button>
						</div>
					</div>
					<div class="col-lg-12 spinner"><img class="pull-right" style="height: 20px; width:20px"
							src="/loader.gif" />
					</div>
				</div>
				<div class="row enquiryContainer">
					<div class="col-lg-3"></div>
					<div class="col-lg-6 sort">
						<img class="img-responsive" src="/enquiry.jpg" />
						<form id="enquiryForm" method="POST">
							<hr>
							<div id="alertContainer">

							</div>
							<div class="form-group">
								<label>Full name:</label>
								<input required name="name" class="form-control" />
							</div>
							<div class="form-group">
								<label>Email:</label>
								<input type="email" required name="email" class="form-control" />
							</div>
							<div class="form-group">
								<label>Phone:</label>
								<input type="tel" name="phone" class="form-control" />
							</div>
							<div class="form-group">
								<label>Address:</label>
								<input name="address" class="form-control" />
							</div>
							<div class="form-group">
								<label>Message:</label>
								<textarea required name="message" class="form-control" /></textarea>
							</div>
							<hr>
							<button id="btnEnquiry" type="submit" class="btn btn-primary">Submit</button>
							<button type="reset" class="btn btn-default">Reset</button> <img
								style="width: 20px; heigth:20px" id="enquirySpinner" src="/loader.gif" />
						</form>
					</div>
					<div class="col-lg-3"></div>
				</div>

				<div class="row feeCompareContainer">
					<div class="col-lg-6">
						<h4><strong id="schoolName1"></strong></h4>
						<div class="form-group has-feedback has-search">
							<span class="glyphicon glyphicon-search form-control-feedback"></span>
							<input type="text" class="form-control" placeholder="Search">
						</div>
						<table class="table table-striped">
							<thead>
								<tr>
									<th scope="col">Course</th>
									<th scope="col">Faculty</th>
									<th scope="col">Fee</th>
								</tr>
							</thead>
							<tbody id="course1Wrapper">
								<tr>
									<td></td>
									<td><img style="width:20px; length:20px" src="/loader.gif" /></td>
									<td></td>
								</tr>
							</tbody>
						</table>
						<hr>
						<button type="button">
							<< Back</button> <button class="pull-right" type="button">Next >>
						</button>
						<hr>
					</div>
					<div class="col-lg-6">
						<h4><strong id="schoolName2"></strong></h4>
						<div class="form-group has-feedback has-search">
							<span class="glyphicon glyphicon-search form-control-feedback"></span>
							<input type="text" class="form-control" placeholder="Search">
						</div>
						<table class="table table-striped">
							<thead>
								<tr>
									<th scope="col">Course</th>
									<th scope="col">Faculty</th>
									<th scope="col">Fee</th>
								</tr>
							</thead>
							<tbody id="course2Wrapper">
								<tr>
									<td></td>
									<td><img style="width:20px; length:20px" src="/loader.gif" /></td>
									<td></td>
								</tr>
							</tbody>
						</table>
						<hr>
						<button type="button">
							<< Back</button> <button class="pull-right" type="button">Next >>
						</button>
						<hr>
					</div>

					<hr>
				</div>

			</div>
		</div>
	</div>
	<script>
		$(function () {
			let enquiryContainer = $(".enquiryContainer");
			let feeCompareContainer = $(".feeCompareContainer");
			let btnSearch = document.getElementById("btnSearch");
			let cboUni1 = document.getElementById("uni1");
			let cboUni2 = document.getElementById("uni2");
			let cboFaculty = document.getElementById("faculty");
			let wrapper1 = $("#course1Wrapper");
			let wrapper2 = $("#course2Wrapper");
			let name1 = $("#schoolName1");
			let name2 = $("#schoolName2");
			let searchSpinner = $(".spinner");
			let cboSearchType = $("#cboSearchType");

			displayContainer(cboSearchType);
			cboSearchType.change(function () {

				displayContainer($(this));

			})
			function displayContainer(input) {
				let val = input.children("option:selected").val();
				if (val == 0) {
					feeCompareContainer.show();
					enquiryContainer.hide();
				} else if (val == 2) {
					feeCompareContainer.hide();
					enquiryContainer.show();
				}
			}
			searchSpinner.hide();

			function getIputs() {
				return {
					uni1: cboUni1.options[cboUni1.selectedIndex],
					uni2: cboUni2.options[cboUni2.selectedIndex],
					faculty: cboFaculty.options[cboFaculty.selectedIndex]
				}
			}
			function template(data) {
				return (`<tr>
						<td>${data.name}</td>
						<td>${data.StudyArea.name}</td>
						<td>${data.fee}</td>
						</tr>`)
			}

			function nullTemplate() {
				return (`<tr><td></td><td>No record found </td><td></td></tr>`)
			}
			function ajaxRequest(uni1, uni2, faculty) {
				if (uni1.value != 0)
					name1.empty().append(uni1.text)
				else
					name1.empty().append("All Institutions")
				if (uni2.value != 0)
					name2.empty().append(uni2.text)
				else
					name2.empty().append("All Institutions")

				$.ajax({
					type: "POST",
					url: "/compareFee",
					data: { institutionId1: uni1.value, institutionId2: uni2.value, facultyId: faculty.value },
					dataType: "json",
					success: function (result) {
						searchSpinner.hide();
						let course1 = result.data.course1;
						let course2 = result.data.course2;

						wrapper1.empty();
						wrapper2.empty();

						if (course1.length == 0)
							wrapper1.append(nullTemplate())

						if (course2.length == 0)
							wrapper2.append(nullTemplate())

						course1.forEach(course => {
							wrapper1.append(template(course));
						})
						course2.forEach(course => {
							wrapper2.append(template(course));
						})
					},
					error: function (er) {

					}
				});
			}
			ajaxRequest(getIputs().uni1, getIputs().uni2, getIputs().faculty);
			btnSearch.addEventListener("click", function () {
				searchSpinner.show();

				ajaxRequest(getIputs().uni1, getIputs().uni2, getIputs().faculty);
			});

			function alertBoxTemplate(message, isError) {
				let classVal = isError ? "alert alert-danger" : "alert alert-success";
				$("#alertContainer").empty().html(`<div class="${classVal}">
									${message}
								</div>`).fadeOut(16000);
			}
			let myform = $("#enquiryForm");
			let enquirySpinner = $("#enquirySpinner");
			let btnEnquiry = $("#btnEnquiry");

			enquirySpinner.hide();
			myform.on('submit', function (e) {
				btnEnquiry.attr("disabled", true);
				enquirySpinner.show();
				e.preventDefault();
				$.ajax({
					type: 'post',
					url: '/enquiry/add',
					data: myform.serialize(),
					success: function (response) {
						btnEnquiry.attr("disabled", false);
						if (!response.error)
							alertBoxTemplate("Thanks for your enquiry, we will get back to you in 2 working days ", false);
						else
							alertBoxTemplate("Form submission was not successful, please try again later.", true);
						enquirySpinner.hide();
					},
					error: function (jqXHR, exception) {
						btnEnquiry.attr("disabled", false);
						alertBoxTemplate("Form submission was not successful, please try again later.", true);
						enquirySpinner.hide();
					}
				});


			})


		});
	</script>
	<!-- coures end here -->


	<!-- coures end here -->